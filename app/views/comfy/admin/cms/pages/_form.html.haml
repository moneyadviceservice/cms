- dough_component = @page.new_record? ? {:data => {'dough-component' => 'Slugifier'}} : {}

- content_for :nav_secondary do
  %li.nav-secondary__item.nav-secondary__item--right
    = render 'comfy/admin/cms/sites/mirrors', :object => @page

- content_for :right_column do
  #form-save.box
    %label.checkbox-inline
      %input{:type => 'checkbox'}
      = ::Comfy::Cms::Page.human_attribute_name(:is_published)
    %button.btn.btn-sm.btn-primary.pull-right
  = render 'comfy/admin/cms/files/index'

= render 'comfy/admin/cms/partials/page_form_before', :object => form

.l-panel-content.l-panel-content--form
  .l-constrained{dough_component}
    = form.text_field :label, hide_label: true, :class => 'form__input form__input--inline form__input--inline--page-title', :placeholder => 'Untitled page', :data => {'dough-slugifier-input' => '', :slugify => @page.new_record?}

    - if (options = ::Comfy::Cms::Layout.options_for_select(@site)).present?
      = form.select :layout_id, options, {}, 'data-url' => form_blocks_comfy_admin_cms_site_page_path(@site, @page.id.to_i)

    = form.text_field :slug, help: "in #{ComfortableMexicanSofa.config.preview_domain}/#{@site.label}/articles/#{@page.slug}", class: 'form__input--has-meta', :data => {'dough-slugifier-slug' => '', :slug => true}

    - if (options = ::Comfy::Cms::Page.options_for_select(@site, @page, nil, 0, false)).present?
      = form.select :target_page_id, [["---- #{t('.select_target_page')} ----", nil]] + options

    = render 'comfy/admin/cms/partials/page_form_inner', object: form
    = render 'comfy/admin/cms/categories/form',          object: form
    = render 'comfy/admin/cms/partials/tags/form',       object: form

    = form.text_field :meta_description
    = form.text_field :meta_title

    .form-group
      .form__label-heading
        &nbsp;
      .form__input-wrapper
        = form.check_box :regulated, label: 'Regulated Content'

= render :partial => 'form_blocks'

.nav-article.is-fixed
  .l-constrained
    .nav-article__inner
      %span.nav-article__item
        %span#t-status
          =@site.label.upcase
          Status:
          =current_status(@page.current_state)
      %span.nav-article__item
        %span.fa.fa-list-ul
        %a.button.button--article.button--h-capitalized{:href => '#'}
          Activity Log
      %span.nav-article__item
        %span.fa.fa-file-o
        %a.button.button--article.button--h-capitalized{:href => '#'}
          Notes

      %span.nav-article__item.nav-article__item--right
        - unless @page.unsaved?
          = link_to t('.preview'), "https://#{ComfortableMexicanSofa.config.preview_domain}/#{@site.label}/articles/#{@page.slug}/preview", :class => 'button button--h-capitalized button--article', id: 'preview', target: '_blank'

      %span.nav-article__item.nav-article__item--right
        .menu
          %span.button-menu
            - main_state_button(@page.current_state).each do |state_event|
              = button_tag state_event[:label], value: state_event[:value], data: state_event[:data], type: 'submit', name: 'state_event', class: "button--action t-#{state_event[:value]}", data: {dough_maseditor_form_submit: true} do
                %span.button__text
                  =state_event[:label]
              - unless page_state_buttons(@page.current_state).empty?
                %span{:data => {:'dough-component' => 'Collapsable', :'dough-collapsable-trigger' => 1, :'dough-collapsable-config' => '{"hideOnBlur": "true"}'}}
                  %span.fa.fa-caret-up

          .menu__body{:data => { :'dough-collapsable-target' => 1 }}
            - page_state_buttons(@page.current_state).each do |state_event|
              .menu__item
                = button_tag state_event[:label], value: state_event[:value], data: state_event[:data], type: 'submit', name: 'state_event', class: "button--action t-#{state_event[:value]}" do
                  %span.button__text
                    =state_event[:label]

= render 'comfy/admin/cms/partials/page_form_after', :object => form
